bk指针指向新入链的块, 即沿着bk的方向, 越往后的块是更晚进bins的块. 如下图, 数字表示free的顺序.

<img alt="bins2" src="./pic/bins2.jpg" width="50%" height="50%">
<img alt="bins3" src="./pic/bins3.jpg" width="50%" height="50%">

新分配块没能在unsorted链中找到时, unsorted链中的空闲块都会根据其大小放到small或large链中

<img alt="unsorted2large1" src="./pic/unsorted2large1.jpg" width="50%" height="50%">
<img alt="unsorted2large2" src="./pic/unsorted2large2.jpg" width="50%" height="50%">

新free一块, 它的相邻freed块在large链中, 进行合并, 得到新的空闲块如下红框所示. 新的块还是在unsorted链中

<img alt="unsorted2large3" src="./pic/unsorted2large3.jpg" width="50%" height="50%">

在有peda插件的gdb中, 显示bins链时, 箭头所指方向都是更早free的块, **箭头也即fd方向**.

malloc如果从bins链中取空闲块时, 取的是fd方向的最前端, 如下图.

<img alt="after_malloc" src="./pic/after_malloc.jpg" width="50%" height="50%">



# fastbin
单链表, 以fd指针相连, 沿着fd的指向往后的块越早进链, 最新进链的块是链表的头部.

<img alt="fastbin_free" src="./pic/fastbin_free.jpg" width="70%" height="70%">

出链时, 最新进链的块先出. 所以这是LIFO结构.

<img alt="fastbin_calloc" src="./pic/fastbin_calloc.jpg" width="70%" height="70%">

# 其他
放入tcache中的相邻的空闲块没有合并(?). 

<img alt="why1" src="./pic/why1.jpg" width="70%" height="70%">